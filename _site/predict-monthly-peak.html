<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Predict monthly peak - ⚡️ Load forecasting and peak shaving with neural networks</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Predict monthly peak | ⚡️ Load forecasting and peak shaving with neural networks</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="Predict monthly peak" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Increasing the accuracy of day-ahead load forecasting can save utilities tens of thousands of dollars. Neural networks and other statistical techniques can help." /> <meta property="og:description" content="Increasing the accuracy of day-ahead load forecasting can save utilities tens of thousands of dollars. Neural networks and other statistical techniques can help." /> <meta property="og:site_name" content="⚡️ Load forecasting and peak shaving with neural networks" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Predict monthly peak" /> <script type="application/ld+json"> {"description":"Increasing the accuracy of day-ahead load forecasting can save utilities tens of thousands of dollars. Neural networks and other statistical techniques can help.","@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/img/logo.png"}},"url":"/predict-monthly-peak","headline":"Predict monthly peak","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">⚡️ Load forecasting and peak shaving with neural networks</a></li><li class="nav-list-item"><a href="/simple-load-forecasting" class="nav-list-link">Forecast hourly load</a></li><li class="nav-list-item"><a href="/day-long-load-forecasting" class="nav-list-link">Forecast day-long load</a></li><li class="nav-list-item active"><a href="/predict-monthly-peak" class="nav-list-link active">Predict monthly peak</a></li><li class="nav-list-item"><a href="/calculate-uncertainty" class="nav-list-link">Calculate uncertainty</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search ⚡️ Load forecasting and peak shaving with neural networks" aria-label="Search ⚡️ Load forecasting and peak shaving with neural networks" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <p><img src="img/headers/predict-monthly-peak.png" alt="" /></p> <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script> <h1 id="how-short-term-forecasting-with-neural-nets-can-inform-long-term-decisions"> <a href="#how-short-term-forecasting-with-neural-nets-can-inform-long-term-decisions" class="anchor-heading" aria-labelledby="how-short-term-forecasting-with-neural-nets-can-inform-long-term-decisions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How short-term forecasting with neural nets can inform long-term decisions. </h1> <h2 id="electric-utilities-can-detect-monthly-peaks-with-only-a-three-day-forecast"> <a href="#electric-utilities-can-detect-monthly-peaks-with-only-a-three-day-forecast" class="anchor-heading" aria-labelledby="electric-utilities-can-detect-monthly-peaks-with-only-a-three-day-forecast"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Electric utilities can detect monthly peaks with only a three-day forecast. </h2> <p><em>September 2, 2019</em></p> <p>For electric utilities, reducing monthly demand charge can be hugely profitable. Implementing a peak shaving strategy every day, however, could be costly. If a utility is using direct load control (paying customers to turn off air conditioners, water heaters, etc.), they may frustrate customers if they do so too frequently. If a utility uses storage, overuse can force them to replace expensive batteries more often than necessary. Therefore, it’s not only important to predict the load shape for the next day, but also to predict the month’s peak. In an ideal world, a utility with a monthly demand charge would need to shave peaks one day a month.</p> <p>Unfortunately, similar to the weather predictions, load predictions get unreliable after a few days. Past three-day forecasts, our predictions level out at 10 mean absolute percent error (MAPE). And since it’s not uncommon for an entire month’s daily peaks to fall within a 10 MAPE band, finding monthly peaks quickly becomes guesswork.</p> <p>Thankfully, by combining a few statistical techniques, we can place tomorrow’s forecast in context and dramatically reduce the number of days we dispatch.</p> <h3 id="the-setup"> <a href="#the-setup" class="anchor-heading" aria-labelledby="the-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Setup </h3> <p>We’re motivated by a single question: is tomorrow this month’s peak?</p> <p>We know that we can’t have a 30-day forecast, but by looking at three-day predictions, what’s already happened this month, and historical peaks, we can answer two smaller questions:</p> <ul> <li>Will tomorrow be a local peak?</li> <li>Is tomorrow’s load especially high for this month?</li> </ul> <p>In the end, we’ll combine the answers to inform our motivating question.</p> <h4 id="will-tomorrow-be-a-local-peak"> <a href="#will-tomorrow-be-a-local-peak" class="anchor-heading" aria-labelledby="will-tomorrow-be-a-local-peak"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Will tomorrow be a local peak? </h4> <p>A “local peak” would mean that tomorrow is the highest in a three-day forecast and also higher than any load already seen this month. In the beta version our web application, this is how it is represented:</p> <p><img src="img/long_term_1.png" alt="" /></p> <p>Above is a forecast for the 20th of December in the north central region of Texas in 2018. Because “tomorrow’s predicted peak” is considerably lower than the highest peak seen so far, a utility would not implement a peak shaving strategy on December 20th.</p> <p>Considering that the model’s prediction is likely accurate around a normal distribution, we can assign a number to the statistical likelihood that tomorrow will be a local peak. It’s given by this formula:</p> <p><img src="img/long_term_2.png" alt="" /></p> <p>Given two normal distributions (subscripts 1 and 2, defined by their mean and standard deviation), what is the likelihood that the sample X₁ will be greater than the sample X₂.</p> <p>If you’re interested in the details, here’s a link to a full explanation. And below is how we expand that formula and translate it into python:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="k">def</span> <span class="nf">peak_likelihood</span><span class="p">(</span><span class="n">hist</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
        <span class="n">tomorrow</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tomorrow_std</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
        <span class="n">two_day</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">two_day_std</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
        <span class="n">three_day</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">three_day_std</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">'''
    Given the predictions and standard deviation of the three-day forecast, in
    addition to the highest load so far this month, what is the likelihood that
    a sample from tomorrow's distribution will be higher than the other three.
    '''</span>
    
    <span class="c1"># likelihood that tomorrow is lower than highest so far this month
</span>    <span class="n">A</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">tomorrow</span><span class="p">,</span> <span class="n">tomorrow_std</span><span class="p">).</span><span class="n">cdf</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
    
    <span class="c1"># likelihood that tomorrow is lower than than the two-day forecast
</span>    <span class="n">B</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">tomorrow</span> <span class="o">-</span> <span class="n">two_day</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">tomorrow_std</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">two_day_std</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">.</span><span class="mi">5</span><span class="p">))</span>
    
    <span class="c1"># likelihood that tomorrow is lower than than the three-day forecast
</span>    <span class="n">C</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">tomorrow</span> <span class="o">-</span> <span class="n">three_day</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">tomorrow_std</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">three_day_std</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">.</span><span class="mi">5</span><span class="p">))</span>
    
    <span class="c1"># likelihood tomorrow is (not A) AND (not B) AND (not C)
</span>    <span class="c1"># in other words, what's the likelihood that tomorrow is local peak
</span>    <span class="k">return</span> <span class="nb">round</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">B</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">C</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

</code></pre></div></div> <p>Using the example from December 20th and rounding to two decimals, the “local peak likelihood” for tomorrow is 0.0%, mostly because the area under the normal distribution for tomorrow’s peak is very small above the highest peak so far.</p> <h4 id="is-tomorrows-load-especially-high-for-this-month"> <a href="#is-tomorrows-load-especially-high-for-this-month" class="anchor-heading" aria-labelledby="is-tomorrows-load-especially-high-for-this-month"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Is tomorrow’s load especially high for this month? </h4> <p>This question is simpler to answer. We look at the monthly data from previous years, and calculate the percentile of tomorrow’s prediction. It’s important to note that we’re calculating percentile with daily peaks, not hourly load.</p> <h4 id="what-are-we-trying-to-minimize"> <a href="#what-are-we-trying-to-minimize" class="anchor-heading" aria-labelledby="what-are-we-trying-to-minimize"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What are we trying to minimize? </h4> <p>We have two factors, “local peak likelihood” and “peak percentile”, and we want to make a rule that will minimize two results, “percent of peaks missed” and “percent of dispatches made.”</p> <p>These two results are tradeoffs that each utility must make. If they want to ensure that every peak is captured (low percent of peaks missed), they must dispatch every day (high percent of dispatches made). And vice versa: if they want to be conservative with the number of dispatches, they run the risk of missing a peak.</p> <p>We need a single target to minimize. So for our purposes, we’ll simply add the two objectives. In the heat maps below, the function to minimize (right), is simply the sum of the other two. Naturally, considering a utility’s priorities, they would weigh this optimization function differently. Since there’s also a monetary aspect to this, a proper cost-benefit analysis would be necessary. But those calculations are unique to each utility.</p> <h3 id="the-results"> <a href="#the-results" class="anchor-heading" aria-labelledby="the-results"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Results </h3> <p>I ran tests on ERCOT data from the various regions of Texas from 2002 to 2018. I ran the program from 2008 to 2018 so that the “peak percentile” variable had some hindsight. The entire testing process can be found in <a href="https://github.com/kmcelwee/load-forecasting/blob/main/notebooks/Efficacy%20of%20short-term%20forecasts%20for%20predicting%20monthly%20peaks.ipynb">this jupyter notebook</a>.</p> <p>I assumed that we had 97% accuracy for one-day forecasts, 95% accuracy for two-day forecasts, and 92% accuracy for three-day forecasts — results that are found commonly in academic literature and also reflected <a href="simple-load-forecasting.html">in our own testing.</a></p> <p><img src="img/long_term_3.png" alt="" /></p> <p>Tests run on ERCOT’s SCENT data (San Antonio, Austin). Minimization of (% peaks missed + % dispatches made) for the two variables (“peak percentile threshold” and “local peak likelihood threshold”)</p> <p>Above is one example from the south central region of Texas. Note that there is a sharp line across the top of the center heat map. More than half of all daily peaks have a 0 percent chance of being a local peak, suggesting that regardless of the optimization method put in place by utilities, this method will immediately cut dispatches in half while rarely missing a peak. This band was revealed in all regions of Texas where this test was performed.</p> <p><img src="img/long_term_4.png" alt="" style="float: left; width: 550px" /></p> <p>It’s important to note that the graphs above, and the results below use the logical “AND” when creating the dispatch rule (e.g. Dispatch if there is ≥ 4% chance of local peak AND tomorrow is ≥ the 99th percentile.) I also tested the logical “OR”, but results where consistently worse.</p> <p>The results are tabulated in the figure below. Note that each of these “rules” are only accurate in hindsight. Each utility would need to test how effective previous policies can be implemented on future loads. As one might expect, there is no one-rule-fits-all when trying to predict monthly peaks. The consistent trend, however, is to dispatch if there is a greater-than single digit chance of a local peak, and if the forecast’s percentile is pretty high. (The results for NORTH are quite different than the rest of Texas, <a href="https://github.com/kmcelwee/mediumBlog/blob/master/load_forecast/NORTH.png">here is a link</a> to its heat map.)</p> <p><img src="img/long_term_5.png" alt="" style="float: right; width: 550px" /></p> <p>The results suggest that the “local peak likelihood” variable is doing most of the heavy lifting in this function, and the percentile factor is helping detect obvious non-peaks in a historical context.</p> <p>It’s not lost on me that this optimization could also be aided by breaking down rules for each month, or even applying some kind of machine learning algorithm; however, because future load behavior can differ from the past based on changing technology and consumption patterns, those processes can easily fall victim to overfitting.</p> <p>There is a great opportunity, however, for utilities to leverage machine learning and basic statistics to better inform their dispatch decisions, saving money and building customer trust in the process.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
